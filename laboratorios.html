<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset= 'utf-8'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://momentjs.com/downloads/moment-with-locales.js"></script>
  	<link rel="stylesheet" type="text/css" href="Assets/CSS/laboratorios.css">
  	<link rel="stylesheet" type="text/css" href="Assets/CSS/menuNavegacao.css">

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <script src="AcessoDados/Base.js"></script>
    <!-- Carregar apenas se necessário na página: -->
    <script src="AcessoDados/Comunidade.js"></script>
    <script src="AcessoDados/Usuario.js"></script>
    <script type= 'text/javascript' src= 'AcessoDados/Perfil.js'></script>


	<script type= 'text/javascript'>
		$(document).ready(function(){
			Comunidade.listar(function(data) {
				conteudo = "";

				for (i = 0; i < data.length; i++) {
					// [dataCriacao, descricao, id, nome, tema]
					conteudo += "<div class='comunidade'><h3><a href=laboratorio.html?id=" + data[i]["id"] + ">" + data[i]["nome"] + "</a></h3>";
					conteudo += "<button class='inativar' type='button' onclick='Comunidade.desativarLaboratorio(" + data[i]["id"] + ")'><i class='fas fa-power-off'></i>Desativar</button><p class='clear-float'></p>";
					conteudo += "Criada em: " + moment(data[i]["dataCriacao"].substring(0,10)).format('DD/MM/YY') + "<br>";
					conteudo += "Tema: " + data[i]["tema"] + "<br><br>";
					conteudo += "<div class='descricao'>" + data[i]["descricao"] + "</div><br>";

					conteudo += "</div>";
				}

				document.getElementById("conteudo").innerHTML = conteudo;
      });
      $('#btn-search').click(function(){
		  var searchTxt= $('#search-labs').val();
		  Comunidade.getByNomeOuDescricao(searchTxt, searchTxt, function(data){
			if (data.erro== true)
			{
			  alert(data.mensagem);
			}else{
			  if (data[0]== null)
			  {
				alert('nenhum resultado encontrado');
			  }else{
				var divConteudo= $('#conteudo');
				divConteudo.empty();
				var dataSize= data.length;
				conteudo = "";

						for (i = 0; i < dataSize; i++) {
							// [dataCriacao, descricao, id, nome, tema]
							conteudo += "<div class='comunidade'><h3><a href=laboratorio.html?id=" + data[i]["id"] + ">" + data[i]["nome"] + "</a></h3>";
							conteudo += "<button class='inativar' type='button' onclick='Comunidade.desativarLaboratorio(" + data[i]["id"] + ")'><i class='fas fa-power-off'></i>Desativar</button><p class='clear-float'></p>";
							conteudo += "Criada em: " + moment(data[i]["dataCriacao"].substring(0,10)).format('DD/MM/YY') + "<br>";
							conteudo += "Tema: " + data[i]["tema"] + "<br><br>";
							conteudo += "<div class='descricao'>" + data[i]["descricao"] + "</div><br>";

							conteudo += "</div>";
						}

						document.getElementById("conteudo").innerHTML = conteudo;
			  }
			}
		  });
      });


		// Submete a pesquisa quando o usuário pressiona ENTER.
		$('#search-labs').on('keyup', function(e) {
			if (e.keyCode === 13) {
				$('#btn-search').click();
			}
		});


    });

	</script>

  </head>
  <body>

    <header style="position: fixed; top: 0;width: 100%; height: 60px;">
      <nav id="barra-navegacao" style="text-align: center;">
      	<ul>
      		<li><a style="color:white;" href="inicio.html" title="Início">Início</a></li>
      		<li><a style="color:white;" href="laboratorios.html" title="Início">Laboratórios</a></li>
      		<li><a style="color:white;" href="usuarios.html" title="Início">Usuários</a></li>
      	</ul>
      	<h1 id='titulo' align="center" style="font-size: 190%;margin-top:0;padding-top:15px;position: static;">Academiq</h1>
      	<div id="dropdown">
      		<div id="user-picture" onclick="myFunction()" class="dropbtn" style="margin-left: 45.5px;"></div>
      		<div id="myDropdown" class="dropdown-content" style="text-align:center; padding-top:17px;"><br>
      			<a href="inicio.html">Home</a>
      			<a href="#about">Perfil</a>
      			<a id="logout" href="#">Logout</a>
      		</div>
      </nav>
    </header>

	<main id="content">
		<div id="topo-labs">
			<button id="btn-create-lab" type="button" onclick="window.location.assign('criarLaboratorio.html')"><i class="fas fa-plus"></i>Criar laboratório</button>

			<div id="search-box">
				<i class="fas fa-search"></i>
				<input type= 'text' id= 'search-labs' placeholder='pesquisar por nome'></input>
				<button type= 'button' id= 'btn-search'>search</button>
			</div>
		</div>
		<p class="clear"></p>

		<div id="conteudo"></div>
	</main>
	<footer></footer>
  </body>
  <script>
		$( "footer" ).load( "footerLogin.html footer" );
		$( "nav" ).load( "menuNavegacao.html nav" );

    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn')) {

        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
	</script>
</html>
